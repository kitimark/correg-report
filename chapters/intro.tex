\chapter{\ifcpe บทนำ\else Introduction\fi}

\section{\ifcpe ที่มาของโครงงาน\else Project rationale\fi}

ทางผู้พัฒนาเคยใช้โปรแกรมลงทะเบียนวิชาเรียนมาเป็นเวลา 3 ปี ได้พบถึงปัญหาการใช้งานต่างๆ เช่น เว็บไซต์สำหรับการลงทะเบียนวิชาเรียนเกิดการล่ม 
รวมถึงเว็บไซต์หลักของสำนักทะเบียน ทำให้ไม่สามารถเข้าถึงเว็บไซต์ลงทะเบียนวิชาโดยง่าย ดังตัวอย่างเช่น Error Establishing a Database Connection ที่อาจจะเกิดปัญหาจากการติดต่อฐานข้อมูลในชั่วขณะหนึ่งที่มีการเชื่อมต่อที่สูงมากๆ จนฐานข้อมูลตอบกลับช้าหรือรับมือกับจำนวนคำร้องขอที่เกิดขึ้น และ 502 Bad Gateway เนื่องจาก Nginx ไม่สามารถมอบอำนาจ (proxy) คำร้องขอนั้นๆ ให้กับโปรแกรมที่ให้บริบการบนเซิฟเวอร์ได้เนื่องจาก โปรแกรมนั้นถูกปิดตัวไป หรือ ไม่สามารถติดต่อได้เนื่องจากระบบเครือข่ายเกิดความเสียหายชั่วคราว หรือ ตัวของระบบลงทะเบียนเองที่มีช่องโหว่อยู่หลายแห่ง เช่น นักศึกษาสามารถลงทะเบียนผ่าน RESTful API โดยตรงโดยที่ไม่ต้องผ่านการตรวจสอบเบื้องต้น ถึงแม้ว่าจะมีการตรวจสอบเบื้องต้นในฝั่ง frontend แล้วก็ตาม รวมถึงขอข้อมูลอย่างที่อยู่ ip ในการส่งแบบฟอร์มเพื่อที่จะลงทะเบียนซึ่งไม่จำเป็นต้องร้องขอข้อมูลเหล่านั้นได้ ซึ่งทั้งหมดสามารถส่งผลกระทบต่อระบบโดยรวมได้

หลังจากที่เราได้สัมภาษณ์ผู้พัฒนาโปรแกรมของสำนักทะเบียนและประมวลผล มหาวิทยาลัยเชียงใหม่แล้ว ทำไห้เราได้พบปัญหาอีกหลายๆ อย่างที่เกิดขึ้น ดังต่อไปนี้

\begin{figure}
    \centering
    \begin{tikzpicture}[ ]
        \node[module] (I0) {reg.cmu.ac.th};
        \node[fit=(I0), draw,inner sep=2mm, label={[xshift=2mm, font=\sffamily]VM}] (fit1) {};
        \node[module, below=of I0] (I1) {regist.reg.cmu.ac.th (nginx)};
        \node[fit=(I1), draw,inner sep=2mm, label={[xshift=2mm, font=\sffamily]VM}] (fit1) {};
        \node[module, below=of I1] (I2) {Regist service};
        \node[module, left=of I2] (I3) {Regist service};
        \node[module, right=of I2] (I4) {Regist service};
        \node[below=of I2, yshift=-4mm] (I5) {MySQL};
        \node[module, below=of I5, yshift=8mm] (I6) {center\_db};
        \node[module, below=of I6, yshift=8mm] (I7) {regist\_db};
        \node[fit=(I2), draw,inner sep=2mm,label={[xshift=2mm, font=\sffamily]Docker VM}] (fit2) {};
        \node[fit=(I3), draw,inner sep=2mm,label={[xshift=2mm, font=\sffamily]Docker VM}] (fit3) {};
        \node[fit=(I4), draw,inner sep=2mm,label={[xshift=2mm, font=\sffamily]Docker VM}] (fit4) {};
        \node[fit=(I5) (I6) (I7), draw,inner sep=2mm,] (fit5) {};
        \node[fit=(I5) (fit5), draw,inner sep=2mm ,label={[xshift=2mm, font=\sffamily]VM}] (fit6) {};
        \draw[->] (I0)--(I1);
        \foreach \i in {2,3,4} {
            \draw[->] (I1)--(I\i);
            \draw[->] (I\i)--(I5);
        }
    \end{tikzpicture}
    \caption{โครงสร้างพื้นฐานที่เราได้สัมภาษณ์จาก ผู้พัฒนาของสำนักทะเบียน}
    \label{fig:reg_infra}
\end{figure}

\begin{itemize}
\item จากรูป \ref{fig:reg_infra} การแบ่งตัวของ VM \cite{vm} ที่นำ มาใช้อย่างไม่มีประสิทธิภาพแบบที่ควรจะเป็น
เนื่องจากกลุ่ม VM เหล่านั้นไม่มี System center orchestrator \cite{sco} ทำให้การขยายตัวเป็นไปได้ยากหรือไม่ได้เลย เมื่อระบบถูกเรียกใช้งานจนถึงมีทรัพยากรไม่เพียงพอใน VM นั้นๆ ทำให้โปรแกรม นั้นไม่สามารกขยายตัวไป VM ที่มีทรัพยากรรองรับเพื่อแบ่งจำนวนของผู้ต้องการใช้งานได้ ซึ่งส่งผลให้ระบบล่มในเวลาต่อมา และส่งผลกระทบต่อ โปรแกรมอื่นๆ 
ที่มีทางเข้าโปรแกรมผ่านโปรแกรมที่ได้ล่มไป เช่น VM ที่ดูแลโปรแกรมที่ให้บริการเว็บไซต์ \url{https://reg.cmu.ac.th/} นั้นเกิดข้อผิดพลาดจึงทำให้ VM นั้นปิดตัวไปชั่วขณะจะทำให้ผู้ใช้งานรวมไปถึงนักศึกษาที่ต้องการลงทะเบียน จะไม่สามารถเข้า \url{https://regist.reg.cmu.ac.th/} ได้โดยง่ายถึงแม้ว่าจะมีทางเข้าโดยตรงก็ตาม เนื่องจาก ผู้ใช้งานบางส่วนในปัจจุบันก็ไม่ทราบถึงทางเข้าถึงนี้อยู่พอสมควร จึงสามารถสรุปได้ว่า เซิฟเวอร์ของสำนักทะเบียนไช้งานได้่อย่างไม่มีประสิทธิภาพ

\item รวมถึงมีข้อมูลในฐานข้อมูลที่ซ้ำซ้อน ในหลายๆ ฐานข้อมูล ซึ่งอาจจะส่งผลกระทบในเรื่องของความไม่แน่นอนของข้อมูล (data inconsistency) ได้ในภายหลัง ซึ่งเราจะกล่าวถึงต่อไปในบทที่ 3

\item การเรียกร้องขอข้อมูลระหว่าง โปรแกรมลงทะเบียนเรียนในฝั่งของเซิฟเวอร์และฐานข้อมูลนั้น \CI{มีความซับซ้อนที่สูง}{อย่างไร}ทำให้การทำงานของตัวฐานข้อมูลนั้นช้าลงไปทำให้ โปรแกรมไม่สามารถรองรับนักศึกษาที่เข้ามาใช้งานได้ถึงแม้ว่า จะมีการทำสำเนาโปรแกรม เพื่อที่จะเพิ่มประสิทธิภาพการทำงาน แต่ก็เป็นการทำสำเนาแบบคงที่ ไม่สามารถปรับจำนวนเพื่อรองรับผู้ใช้งาน ณ ขณะหนึ่ง
\end{itemize}

เราจึงจะพัฒนาระบบลงทะเบียนซึ่งจะถูกกล่าวถึงในบทที่ 3 ที่มีสามารถรองรับการใช้งานตามจำนวนของนักศึกษาที่กำลังศึกษาอยู่ และ ระบบนี้สามารถป้องกัน ความขัดแย้งกันของข้อมูลได้ (data consistency){แปลว่าอะไร} โดยการทำให้ \CI{หลายๆ ฐานข้อมูล}{มีทั้งหมดกี่ฐานข้อมูล และจำเป็นต้องมีหลายฐานข้อมูลหรือไม่ ถ้ามี มีไปเพื่ออะไร ทำไมต้องแยกฐานข้อมูลกัน}สามารถทำงานร่วมกันได้

\section{\ifcpe วัตถุประสงค์ของโครงงาน\else Objectives\fi}
\begin{enumerate}
    \item เพิ่มประสิทธิภาพของระบบลงทะเบียน ลดภาระการทำงานของการของระบบฐานข้อมูล
    \item ระบบสามารถรองรับการใช้งานของจำนวนนักศึกษาที่กำลังศึกษาอยู่
    \item ออกแบบโปรแแกรมฝั่งเซิฟเวอร์โดยที่ไม่มีช่องโหว่ดังที่กล่าวข้างต้น
    \item ลดความซ้ำซ้อนของข้อมูลในฐานข้อมูล
\end{enumerate}

\section{\ifcpe ขอบเขตของโครงงาน\else Project scope\fi}

\subsection{\ifcpe ขอบเขตด้านฮาร์ดแวร์\else Hardware scope\fi}
\begin{enumerate}
    \item PC ที่สามารถเข้าถึง browser เพื่อทดสอบ GraphQL API
    \item มีชื่อ domain หรือ sub-domain ที่สามารถเข้าถึงได้\CIreply{แปลว่าอะไร}
    \item กลุ่มเซิฟเวอร์ที่มี Kubernetes รองรับไว้อยู่แล้ว
\end{enumerate}
\subsection{\ifcpe ขอบเขตด้านซอฟต์แวร์\else Software scope\fi}
\begin{enumerate}
    \item ฐานข้อมูลต้องเพียงพอรองรับต่อการลงทะเบียน\CIreply{อะไรเพียงพอ? storage? throughput?}
    % \item สามารถใช้งานร่วมกับ frontend ที่ทำหน้าที่แสดงผลการลงทะเบียน\CIreply{ใช้งานอะไรร่วมกับ frontend?}
    \item ใช้การออกแบบเว็บไซต์ที่มีการออกแบบคล้ายเดิม แต่ใช้เปลี่ยน layer การติดต่อข้อมูลเป็น GraphQL API \cite{graphql} ระหว่าง frontend และ backend
\end{enumerate}
\section{\ifcpe ประโยชน์ที่ได้รับ\else Expected outcomes\fi}
\begin{enumerate}
    \item ระบบลงทะเบียนสามารถตอบรับตามจำนวนนักศึกษาที่ต้องการได้
    \item ระบบลงทะเบียนสามารถใช้ประสิทธิภาพของ server ได้สูงสุด
    \item ไม่มีข้อมูลที่ซ้ำซ้อน (ไม่ต้อง update ข้อมูลหลายๆ ที่)
    \item ลดความขัดแย้งกันของข้อมูล (data inconsistency) ของส่วนของการลงทะเบียน
\end{enumerate}

\section{\ifcpe เทคโนโลยีและเครื่องมือที่ใช้\else Technology and tools\fi}

เทคโนโลยีและเครื่องมือที่ใช้ที่กำลังจะกล่าวถึงด้านล่าง จะอธิบายเพิ่มเติมต่อในบทที่ 2

\subsection{\ifcpe เทคโนโลยีด้านฮาร์ดแวร์\else Hardware technology\fi}
\begin{enumerate}
    \item Kubernetes Cluster
    \item VM Instances
\end{enumerate}

\subsection{\ifcpe เทคโนโลยีด้านซอฟต์แวร์\else Software technology\fi}
\subsubsection{Frontend}
\begin{enumerate}
    \item Nextjs \cite{nextjs}
    \item Reactjs \cite{reactjs}
\end{enumerate}

\subsubsection{Backend}
\begin{enumerate}
    \item Nestjs \cite {nestjs}
    \item GraphQL \cite {graphql}
\end{enumerate}

\subsubsection{Database}
\begin{enumerate}
    \item MySQL \cite {mysql}
\end{enumerate}

\subsubsection{Tools \& Library}
\begin{enumerate}
    \item Nodejs \cite {nodejs}
    \item DataLoader \cite {dataloader}
\end{enumerate}

\subsubsection{Infrastructure}
\begin{enumerate}
    \item Docker \cite {docker}
    \item Kubernetes \cite {kubernetes}
\end{enumerate}

\section{\ifcpe แผนการดำเนินงาน\else Project plan\fi}
\begin{plan}{6}{2020}{2}{2021}
    \planitem{6}{2020}{7}{2020}{ศึกษาการเปลี่ยนถ่ายระบบ (software transition) และกรณีศึกษา}
    \planitem{7}{2020}{7}{2020}{ศึกษาการวางแผนการขยายตัวของ pod ใน kubernetes เพื่อรองรับการขยายตัวของผู้ใช้งานระยะสั้น}
    \planitem{8}{2020}{8}{2020}{ศึกษาการใช้งาน prometheus, grafana และ ระบบ monitoring อื่นๆ ใน kubernetes}
    \planitem{9}{2020}{9}{2020}{สอบถามนักพัฒนาของสำนักทะเบียน}
    \planitem{9}{2020}{9}{2020}{สังเกตุการทำงาน และปัญหาของระบบลงทะเบียน}
    \planitem{9}{2020}{11}{2020}{วางแผนออกแบบระบบ ตามข้อกำจัด และปัญหาที่สังเกตได้}
    \planitem{11}{2020}{12}{2020}{พัฒนาระบบฐานข้อมูลของการลงทะเบียน}
    \planitem{11}{2020}{12}{2020}{พัฒนาระบบเครือข่ายใน Kubernetes}
    \planitem{12}{2020}{12}{2020}{พัฒนาระบบขยายตัวระยะสั้นของ pod ใน kubernetes}
    \planitem{11}{2020}{1}{2021}{ทดสอบ unit testing}
    \planitem{12}{2020}{2}{2021}{ทดสอบ integration testing}
    \planitem{1}{2021}{2}{2021}{ทดสอบ load testing และ ปรับปรุงระบบ}
\end{plan}

\section{\ifcpe บทบาทและความรับผิดชอบ\else Roles and responsibilities\fi}
ในการพัฒนาระบบครั้งนี้เราจำเป็นต้องใช้ความรู้และความเข้าใจในเรื่องของ containerization \cite{containerization} และ container orchestration \cite{orchestration} และความเข้าใจในการดึงข้อมูลและนำข้อมูลมารวมตัว (aggregation \cite{aggregation}) และ design pattern ที่เหมาะสำหรับซอฟแวร์ ที่จะนำมาใช้

\section{\ifcpe%
ผลกระทบด้านสังคม สุขภาพ ความปลอดภัย กฎหมาย และวัฒนธรรม
\else%
Impacts of this project on society, health, safety, legal, and cultural issues
\fi}

ระบบนี้จะช่วยทำให้ลดความซ้ำซ้อนของข้อมูล ในทางเดียวกันทำเชิฟเวอร์ ใช้พื้นที่เก็บข้อมูลได้น้อยลง และ ลดการใช้พลังงานของตัวเซิฟเวอร์หรือ ใช้เท่าที่จำเป็น