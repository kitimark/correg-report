\chapter{\ifcpe บทนำ\else Introduction\fi}
\label{ch:intro}

\section{\ifcpe ที่มาของโครงงาน\else Project rationale\fi}

จากประสบการณ์ของผู้พัฒนาที่ได้ใช้โปรแกรมลงทะเบียนเรียน ที่พัฒนาโดยสำนักทะเบียนและประมวลผล มหาวิทยาลัยเชียงใหม่มาเป็นเวลา 3 ปี ได้พบถึงปัญหาการใช้งานต่างๆ เช่น เว็บไซต์สำหรับการลงทะเบียนวิชาเรียน หรือเว็บไซต์หลักของสำนักทะเบียนฯ เกิดการล่ม 
ทำให้ไม่สามารถเข้าถึงเว็บไซต์ลงทะเบียนวิชาได้โดยง่าย เช่น เว็บไซต์หลักอาจจะแสดงข้อผิดพลาดว่า Error Establishing a Database Connection ที่อาจจะเกิดปัญหาจากการติดต่อฐานข้อมูลในชั่วขณะหนึ่งที่มีการเชื่อมต่อที่สูงมากๆ จนฐานข้อมูลตอบกลับช้าหรือรับมือไม่ทันกับจำนวนคำร้องขอที่เกิดขึ้น หรือแสดงรหัสข้อผิดพลาด 502 Bad Gateway เนื่องจาก Nginx ไม่สามารถมอบอำนาจ (proxy) คำร้องขอนั้นๆ ให้กับโปรแกรมที่ให้บริการบนเซิฟเวอร์ได้เนื่องจาก โปรแกรมนั้นถูกปิดตัวไป หรือ ไม่สามารถติดต่อได้เนื่องจากระบบเครือข่ายเกิดความเสียหายชั่วคราว หรือตัวของระบบลงทะเบียนเองที่มีช่องโหว่อยู่หลายแห่ง เช่น นักศึกษาสามารถลงทะเบียนผ่าน RESTful API โดยตรงโดยที่ไม่ต้องผ่านการตรวจสอบเบื้องต้น ถึงแม้ว่าจะมีการตรวจสอบเบื้องต้นในฝั่ง frontend แล้วก็ตาม รวมถึงขอข้อมูลอย่างที่อยู่ IP ในการส่งแบบฟอร์มเพื่อที่จะลงทะเบียนซึ่งไม่จำเป็นต้องร้องขอข้อมูลเหล่านั้นได้ ซึ่งทั้งหมดสามารถส่งผลกระทบต่อระบบโดยรวมได้

ภายหลังการสัมภาษณ์ผู้พัฒนาโปรแกรมของสำนักทะเบียนและประมวลผล มหาวิทยาลัยเชียงใหม่ เราได้พบปัญหาอีกหลายๆ อย่างที่เกิดขึ้น ดังต่อไปนี้

\begin{figure}
    \centering
    \begin{tikzpicture}[ ]
        \node[module] (I0) {reg.cmu.ac.th};
        \node[fit=(I0), draw,inner sep=2mm, label={[xshift=2mm]VM}] (fit1) {};
        \node[module, below=of I0] (I1) {regist.reg.cmu.ac.th (nginx)};
        \node[fit=(I1), draw,inner sep=2mm, label={[xshift=2mm]VM}] (fit1) {};
        \node[module, below=of I1] (I2) {Regist service};
        \node[module, left=of I2] (I3) {Regist service};
        \node[module, right=of I2] (I4) {Regist service};
        \node[below=of I2, yshift=-4mm] (I5) {MySQL};
        \node[module, below=of I5, yshift=8mm] (I6) {center\_db};
        \node[module, below=of I6, yshift=8mm] (I7) {regist\_db};
        \node[fit=(I2), draw,inner sep=2mm,label={[xshift=2mm]Docker VM}] (fit2) {};
        \node[fit=(I3), draw,inner sep=2mm,label={[xshift=2mm]Docker VM}] (fit3) {};
        \node[fit=(I4), draw,inner sep=2mm,label={[xshift=2mm]Docker VM}] (fit4) {};
        \node[fit=(I5) (I6) (I7), draw,inner sep=2mm,] (fit5) {};
        \node[fit=(I5) (fit5), draw,inner sep=2mm ,label={[xshift=2mm]VM}] (fit6) {};
        \draw[->] (I0)--(I1);
        \foreach \i in {2,3,4} {
            \draw[->] (I1)--(I\i);
            \draw[->] (I\i)--(I5);
        }
    \end{tikzpicture}
    \caption{โครงสร้างพื้นฐานที่เราได้สัมภาษณ์จาก ผู้พัฒนาของสำนักทะเบียน}
    \label{fig:reg_infra}
\end{figure}

\begin{itemize}
\item จากรูป \ref{fig:reg_infra} การแบ่งตัวของ VM \cite{vm} ที่ไม่มีประสิทธิภาพแบบที่ควรจะเป็น
เนื่องจากกลุ่ม VM เหล่านั้นไม่มี system center orchestrator \cite{sco} ทำให้การขยายตัวเป็นไปได้ยากหรือไม่ได้เลย เมื่อระบบถูกเรียกใช้งานจนมีทรัพยากรไม่เพียงพอใน VM นั้นๆ ทำให้โปรแกรมนั้นไม่สามารกขยายตัวไปยัง VM อื่นๆ ที่มีทรัพยากรเพียงพอที่จะแบกรับความต้องการของผู้ใช้งานเพิ่มเติมได้ ซึ่งส่งผลให้ระบบล่มในเวลาต่อมา และส่งผลกระทบต่อโปรแกรมอื่นๆ 
ที่มีทางเข้าโปรแกรมผ่านระบบที่ได้ล่มไป เช่น VM ที่ดูแลโปรแกรมที่ให้บริการเว็บไซต์ \url{https://reg.cmu.ac.th/} นั้นเกิดข้อผิดพลาดจึงทำให้ VM นั้นปิดตัวไปชั่วขณะ ซึ่งจะทำให้ผู้ใช้งานรวมไปถึงนักศึกษาที่ต้องการลงทะเบียน จะไม่สามารถเข้า \url{https://regist.reg.cmu.ac.th/} ได้โดยง่ายถึงแม้ว่าจะมีทางเข้าโดยตรงก็ตาม ทั้งนี้เนื่องจาก ผู้ใช้งานส่วนมากในปัจจุบันก็ไม่ทราบถึง URL โดยตรงนี้ จึงสามารถสรุปได้ว่า เซิฟเวอร์ของสำนักทะเบียนใช้งานได้อย่างไม่มีประสิทธิภาพ

\item รวมถึงมีข้อมูลในฐานข้อมูลที่ซ้ำซ้อน ในหลายๆ ฐานข้อมูล ซึ่งอาจจะส่งผลกระทบในเรื่องของความไม่แน่นอนของข้อมูล (data inconsistency) ได้ในภายหลัง ซึ่งเราจะกล่าวถึงต่อไปในบทที่ 3

\item การเรียกร้องขอข้อมูลระหว่าง โปรแกรมลงทะเบียนเรียนในฝั่งของเซิฟเวอร์และฐานข้อมูลนั้น มีการประมวลผลที่สูง ทำให้การตอบสนองข้อมูลของผู้ร้องขอจากตัวฐานข้อมูลนั้นช้าลงไป ส่งผลให้ โปรแกรมไม่สามารถรองรับนักศึกษาที่เข้ามาใช้งานได้ถึงแม้ว่า จะมีการทำสำเนาโปรแกรม เพื่อที่จะเพิ่มประสิทธิภาพการทำงาน แต่ก็ยังไม่สามารถลดการประมวลผลของฐานข้อมูลได้

\item แม้ว่าโปรแกรมฝั่งเซฟเวอร์เองมีการสำเนา แต่ก็เป็นการทำสำเนาแบบคงที่ ไม่สามารถปรับจำนวนสำเนาเพื่อรองรับผู้ใช้งาน ณ ขณะหนึ่ง ซึ่งสำเนาที่คงที่จะทำให้มีการร้องขอทรัพยากรเพื่อที่จะดำเนินต่อไป ดังนั้นสามารถสรุปได้ว่ามีการใช้งานของทรัพยากรเกินความจำเป็น
\end{itemize}

เราจึงจะพัฒนาระบบลงทะเบียนซึ่งจะถูกกล่าวโดยละเอียดในบทที่~\ref{ch:approach} ที่สามารถรองรับการใช้งานตามจำนวนของนักศึกษาที่กำลังศึกษาอยู่ และสามารถป้องกันความขัดแย้งกันของข้อมูล (data inconsistency) ที่เกิดจากการมีข้อมูลเดียวกันอยู่ในฐานข้อมูลมากกว่าหนึ่งฐานได้ โดยกำหนดฐานข้อมูลหลักที่จะรับผิดชอบการดูแลข้อมูลหนึ่งๆ และสร้าง layer ภายในโปรแกรมของฝั่งเซิฟเวอร์ที่ทำให้หลายๆ ฐานข้อมูลสามารถทำงานร่วมกันหรือรวมข้อมูลด้วยกันได้ และอีกทั้งปิดช่องโหว่ที่ระบบเก่ายังคงมีอยู่

\section{\ifcpe วัตถุประสงค์ของโครงงาน\else Objectives\fi}
\begin{enumerate}
    \item เพิ่มประสิทธิภาพของระบบลงทะเบียน ลดภาระการทำงานของการของระบบฐานข้อมูล
    \item ระบบสามารถรองรับการใช้งานของจำนวนนักศึกษาที่กำลังศึกษาอยู่
    \item ออกแบบโปรแกรมฝั่งเซิฟเวอร์โดยที่ไม่มีช่องโหว่ดังที่กล่าวข้างต้น
    \item ลดความซ้ำซ้อนของข้อมูลในฐานข้อมูล
\end{enumerate}

\section{\ifcpe ขอบเขตของโครงงาน\else Project scope\fi}

\subsection{\ifcpe ขอบเขตด้านฮาร์ดแวร์\else Hardware scope\fi}
\begin{enumerate}
    \item PC ที่สามารถเข้าถึง browser เพื่อทดสอบ HTTP request
    \item กลุ่มเซิฟเวอร์ที่มี Kubernetes รองรับไว้อยู่แล้ว
\end{enumerate}
\subsection{\ifcpe ขอบเขตด้านซอฟต์แวร์\else Software scope\fi}
\begin{enumerate}
    \item ฐานข้อมูลต้องมีหน่วยความจำถาวรเพียงพอรองรับต่อการลงทะเบียนของนักศึกษา
    \item ใช้เว็บไซต์ที่มีการออกแบบคล้ายเดิม แต่เพิ่มประสิทธิภาพในการทำงานในส่วนของ backend
\end{enumerate}
\section{\ifcpe ประโยชน์ที่ได้รับ\else Expected outcomes\fi}
\begin{enumerate}
    \item ระบบลงทะเบียนสามารถตอบรับตามจำนวนนักศึกษาที่ต้องการได้
    \item ระบบลงทะเบียนสามารถใช้ประสิทธิภาพของ server ได้สูงสุด
    \item ไม่มีข้อมูลที่ซ้ำซ้อน (ไม่ต้อง update ข้อมูลหลายๆ ที่)
    \item ลดความขัดแย้งกันของข้อมูล (data inconsistency) ของส่วนของการลงทะเบียน
\end{enumerate}

\section{\ifcpe เทคโนโลยีและเครื่องมือที่ใช้\else Technology and tools\fi}

เทคโนโลยีและเครื่องมือที่ใช้ที่กำลังจะกล่าวถึงด้านล่าง จะอธิบายเพิ่มเติมต่อในบทที่~\ref{ch:background}

\subsection{\ifcpe เทคโนโลยีด้านฮาร์ดแวร์\else Hardware technology\fi}
\begin{enumerate}
    \item Kubernetes cluster
    \item VM instances
\end{enumerate}

\subsection{\ifcpe เทคโนโลยีด้านซอฟต์แวร์\else Software technology\fi}

\begin{enumerate}
    \item NestJS \cite {nestjs}
    \item MySQL \cite {mysql}
    \item NodeJS \cite {nodejs}
    \item Docker \cite {docker}
    \item Kubernetes \cite {kubernetes}
\end{enumerate}

\section{\ifcpe แผนการดำเนินงาน\else Project plan\fi}
\begin{plan}{6}{2020}{2}{2021}
    \planitem{6}{2020}{7}{2020}{ศึกษาการเปลี่ยนถ่ายระบบ (software transition) และกรณีศึกษา}
    \planitem{7}{2020}{7}{2020}{ศึกษาการวางแผนการขยายตัวของ pod ใน kubernetes เพื่อรองรับการขยายตัวของผู้ใช้งานระยะสั้น}
    \planitem{8}{2020}{8}{2020}{ศึกษาการใช้งาน prometheus, grafana และ ระบบ monitoring อื่นๆ ใน kubernetes}
    \planitem{9}{2020}{9}{2020}{สอบถามนักพัฒนาของสำนักทะเบียน}
    \planitem{9}{2020}{9}{2020}{สังเกตุการทำงาน และปัญหาของระบบลงทะเบียน}
    \planitem{10}{2020}{10}{2020}{ศึกษาการทำงานของ DataLoader}
    \planitem{9}{2020}{11}{2020}{วางแผนออกแบบระบบ ตามข้อกำจัด และปัญหาที่สังเกตได้}
    \planitem{11}{2020}{12}{2020}{พัฒนาระบบฐานข้อมูลของการลงทะเบียน}
    \planitem{11}{2020}{12}{2020}{พัฒนาระบบเครือข่ายใน Kubernetes}
    \planitem{12}{2020}{12}{2020}{พัฒนาระบบขยายตัวระยะสั้นของ pod ใน kubernetes}
    \planitem{11}{2020}{1}{2021}{ทดสอบ unit testing}
    \planitem{12}{2020}{2}{2021}{ทดสอบ integration testing}
    \planitem{1}{2021}{2}{2021}{ทดสอบ load testing และ ปรับปรุงระบบ}
\end{plan}

\section{\ifcpe บทบาทและความรับผิดชอบ\else Roles and responsibilities\fi}
ในการพัฒนาระบบครั้งนี้เราจำเป็นต้องใช้ความรู้และความเข้าใจในเรื่องของ containerization \cite{containerization} และ container orchestration \cite{orchestration} และความเข้าใจในการดึงข้อมูลและนำข้อมูลมารวมตัว (aggregation \cite{aggregation}) และ design patterns ที่เหมาะสำหรับซอฟต์แวร์ที่จะนำมาใช้

\section{\ifcpe%
ผลกระทบด้านสังคม สุขภาพ ความปลอดภัย กฎหมาย และวัฒนธรรม
\else%
Impacts of this project on society, health, safety, legal, and cultural issues
\fi}

โปรเจคนี้ได้ทำการวิเคราะห์ความซ้ำซ้อนของระบบ และปรับปรุงในระบบมีความซับซ้อนน้อยลง หรือเท่าที่จำเป็น และลดการใช้ทรัพยากรของเซิฟเวอร์หรือ ใช้เท่าที่จำเป็น